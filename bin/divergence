#!/usr/bin/env ruby

require "thor"
require "thor/group"

module CLI
  class Init < Thor::Group
    include ::Thor::Actions

    argument :name
    desc "Initializes a divergence application"

    def self.source_root
      ::File.expand_path('../../generators/files',  __FILE__)
    end

    def create_directories
      empty_directory name
      empty_directory "#{name}/config"
    end

    def copy_templates
      template "config.rb", "#{name}/config/config.rb"
      template "config.ru", "#{name}/config.ru"
    end
  end
end

module CLI
  class Base < Thor
    register CLI::Init, "init", "init [DIR]", "Initializes a divergence application"

    desc "start", "Start divergence"
    method_options :port => :number
    def start
      if options[:port]
        `rackup -p #{options[:port]}`
      else
        `rackup`
      end
    end
  end
end

CLI::Base.start